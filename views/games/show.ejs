<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<section>
	<p>From the Elite Gamer of <%= game.owner.name %>...</p>
  <h1><%= game.name %> 🎮</h1>
  <div>Game: </div>
  <div><%= game.name %></div>
  <div>Status: </div>
  <div><%= game.status %></div>
  <div>Platform: </div>
  <div><%= game.platform %></div>
  <% if (game.owner.equals(user?.profile._id)) { %>
    <a href="/games/<%= game._id %>/edit">
      <button class="btn">Edit 🎮🚧</button>
    </a>
    <form action="/games/<%= game._id %>?_method=DELETE" method="POST">
      <button class="btn" type="submit">Delete 🎮💀</button>
    </form>
  <% } %>
  <h2>Notes:</h2>
  <ul>
    <% game.notes?.forEach(note => { %>
      <li>
        <%= note.content%> 
        &nbsp;at 
        <%= note.createdAt.toLocaleString() %>
        <% if (note.author.equals(user?.profile._id)) { %>
          <a href="/games/<%= game._id %>/notes/<%= note._id %>/edit">
            <button class="btn edit-btn">Edit 📝</button>
          </a>
          <form action="/games/<%= game._id %>/notes/<%= note._id %>?_method=DELETE" method="POST">
            <button class="btn delete-btn">Delete 🗑️</button>
          </form>
        <% } %> 
      </li>
    <% }) %>
  </ul>
  <% if (note.author.equals(user?.profile._id)) { %>
    <h3>Add a Note</h3>
    <form action="/games/<%= game._id %>/notes" method="POST">
      <textarea name="content"></textarea><br>
      <button type="submit">Add Note</button>
    </form>
  <% } %>
</section>

<%- include('../partials/footer') %>